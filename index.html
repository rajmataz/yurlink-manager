<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yURLink Manager üîó</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            transition: all 0.5s ease;
        }

        /* Theme Backgrounds */
        body.theme-ocean {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body.theme-sunset {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
        }

        body.theme-forest {
            background: linear-gradient(135deg, #134e5e 0%, #71b280 100%);
        }

        body.theme-midnight {
            background: linear-gradient(135deg, #232526 0%, #414345 100%);
        }

        body.theme-aurora {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        body.theme-volcano {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
        }

        body.theme-cyberpunk {
            background: linear-gradient(135deg, #0f3460 0%, #e94560 100%);
        }

        body.theme-cosmic {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            min-width: 100px;
        }

        .add-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .input-field {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        .url-input {
            grid-column: 1 / -1;
        }

        .tag-input {
            grid-column: 1 / -1;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .controls-left {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .controls-right {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .theme-selector {
            display: flex;
            gap: 8px;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 15px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .theme-btn {
            width: 25px;
            height: 25px;
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .theme-btn:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .theme-btn.active {
            border-width: 3px;
            transform: scale(1.1);
        }

        .theme-btn.ocean { background: linear-gradient(135deg, #667eea, #764ba2); }
        .theme-btn.sunset { background: linear-gradient(135deg, #ff9a9e, #fecfef); }
        .theme-btn.forest { background: linear-gradient(135deg, #134e5e, #71b280); }
        .theme-btn.midnight { background: linear-gradient(135deg, #232526, #414345); }
        .theme-btn.aurora { background: linear-gradient(135deg, #a8edea, #fed6e3); }
        .theme-btn.volcano { background: linear-gradient(135deg, #ff6b6b, #ffa500); }
        .theme-btn.cyberpunk { background: linear-gradient(135deg, #0f3460, #e94560); }
        .theme-btn.cosmic { background: linear-gradient(135deg, #667eea, #764ba2, #f093fb); }

        .search-filter {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            min-width: 250px;
        }

        .filter-select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
        }

        .links-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .link-card {
            background: linear-gradient(135deg, #f8f9ff, #e8ecff);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
            position: relative;
        }

        .link-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .link-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .link-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .link-url {
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
            word-break: break-all;
        }

        .link-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tag {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .link-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #ffa726;
            color: white;
        }

        .btn-share {
            background: #42a5f5;
            color: white;
        }

        .social-share-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .social-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .social-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .social-btn.twitter {
            background: linear-gradient(135deg, #1da1f2, #0d8bd9);
            color: white;
        }

        .social-btn.facebook {
            background: linear-gradient(135deg, #4267b2, #365899);
            color: white;
        }

        .social-btn.linkedin {
            background: linear-gradient(135deg, #0077b5, #005885);
            color: white;
        }

        .social-btn.reddit {
            background: linear-gradient(135deg, #ff4500, #cc3600);
            color: white;
        }

        .social-btn.telegram {
            background: linear-gradient(135deg, #0088cc, #006bb3);
            color: white;
        }

        .social-btn.whatsapp {
            background: linear-gradient(135deg, #25d366, #1ebe57);
            color: white;
        }

        .social-btn.copy {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
        }

        .btn-delete {
            background: #ef5350;
            color: white;
        }

        .btn-open {
            background: #66bb6a;
            color: white;
        }

        .btn-small:hover {
            transform: scale(1.05);
        }

        .date-added {
            font-size: 12px;
            color: #666;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .browser-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .browser-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .browser-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state img {
            width: 100px;
            opacity: 0.5;
            margin-bottom: 20px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .link-card {
            animation: slideIn 0.3s ease;
        }

        @media (max-width: 768px) {
            .input-group {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-filter {
                justify-content: center;
            }
            
            .link-actions {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1>üîó yURLink Manager</h1>
            <p>Your intelligent URL link depository & management companion</p>
            <div class="stats">
                <div class="stat-item">
                    <div id="totalLinks">0</div>
                    <small>Total Links</small>
                </div>
                <div class="stat-item">
                    <div id="totalTags">0</div>
                    <small>Tags</small>
                </div>
                <div class="stat-item">
                    <div id="todayAdded">0</div>
                    <small>Added Today</small>
                </div>
            </div>
        </div>

        <!-- Add Link Section -->
        <div class="add-section">
            <h2>üìù Add New Link</h2>
            <form id="addLinkForm">
                <div class="input-group">
                    <input type="text" id="linkTitle" class="input-field" placeholder="Link Title" required>
                    <input type="text" id="linkCategory" class="input-field" placeholder="Category">
                </div>
                <input type="url" id="linkUrl" class="input-field url-input" placeholder="https://example.com" required>
                <input type="text" id="linkTags" class="input-field tag-input" placeholder="Tags (comma separated)">
                <button type="submit" class="btn btn-primary">üöÄ Add Link</button>
            </form>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-left">
                <div class="search-filter">
                    <input type="text" id="searchInput" class="search-input" placeholder="üîç Search links...">
                    <select id="categoryFilter" class="filter-select">
                        <option value="">All Categories</option>
                    </select>
                    <select id="sortBy" class="filter-select">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="title">Title A-Z</option>
                    </select>
                </div>
            </div>
            <div class="controls-right">
                <div class="theme-selector">
                    <span style="font-size: 12px; font-weight: 600; color: #666;">üé®</span>
                    <div class="theme-btn ocean active" onclick="app.changeTheme('ocean')" title="Ocean"></div>
                    <div class="theme-btn sunset" onclick="app.changeTheme('sunset')" title="Sunset"></div>
                    <div class="theme-btn forest" onclick="app.changeTheme('forest')" title="Forest"></div>
                    <div class="theme-btn midnight" onclick="app.changeTheme('midnight')" title="Midnight"></div>
                    <div class="theme-btn aurora" onclick="app.changeTheme('aurora')" title="Aurora"></div>
                    <div class="theme-btn volcano" onclick="app.changeTheme('volcano')" title="Volcano"></div>
                    <div class="theme-btn cyberpunk" onclick="app.changeTheme('cyberpunk')" title="Cyberpunk"></div>
                    <div class="theme-btn cosmic" onclick="app.changeTheme('cosmic')" title="Cosmic"></div>
                </div>
                <button class="btn btn-primary" onclick="exportLinks()">üì§ Export Links</button>
            </div>
        </div>

        <!-- Links Container -->
        <div class="links-container">
            <div id="linksGrid"></div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('editModal')">&times;</button>
            <h3>‚úèÔ∏è Edit Link</h3>
            <form id="editLinkForm">
                <div class="input-group">
                    <input type="text" id="editTitle" class="input-field" placeholder="Link Title" required>
                    <input type="text" id="editCategory" class="input-field" placeholder="Category">
                </div>
                <input type="url" id="editUrl" class="input-field url-input" placeholder="https://example.com" required>
                <input type="text" id="editTags" class="input-field tag-input" placeholder="Tags (comma separated)">
                <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
            </form>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('shareModal')">&times;</button>
            <h3>üì§ Share Link</h3>
            <div id="shareContent">
                <div style="text-align: center; margin-bottom: 20px;">
                    <h4 id="shareTitle"></h4>
                    <p style="color: #666; margin: 10px 0; word-break: break-all;" id="shareUrl"></p>
                </div>
                <div class="social-share-grid">
                    <a href="#" class="social-btn twitter" id="twitterShare" target="_blank">
                        <span style="font-size: 20px;">üê¶</span>
                        <small>Twitter</small>
                    </a>
                    <a href="#" class="social-btn facebook" id="facebookShare" target="_blank">
                        <span style="font-size: 20px;">üìò</span>
                        <small>Facebook</small>
                    </a>
                    <a href="#" class="social-btn linkedin" id="linkedinShare" target="_blank">
                        <span style="font-size: 20px;">üíº</span>
                        <small>LinkedIn</small>
                    </a>
                    <a href="#" class="social-btn reddit" id="redditShare" target="_blank">
                        <span style="font-size: 20px;">ü§ñ</span>
                        <small>Reddit</small>
                    </a>
                    <a href="#" class="social-btn telegram" id="telegramShare" target="_blank">
                        <span style="font-size: 20px;">‚úàÔ∏è</span>
                        <small>Telegram</small>
                    </a>
                    <a href="#" class="social-btn whatsapp" id="whatsappShare" target="_blank">
                        <span style="font-size: 20px;">üí¨</span>
                        <small>WhatsApp</small>
                    </a>
                    <button class="social-btn copy" onclick="copyShareLink()">
                        <span style="font-size: 20px;">üìã</span>
                        <small>Copy Link</small>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Browser Selection Modal -->
    <div id="browserModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('browserModal')">&times;</button>
            <h3>üåê Choose Browser</h3>
            <p>Select how you'd like to open this link:</p>
            <div class="browser-selection">
                <div class="browser-btn" onclick="openInBrowser('current')">
                    <div>üåê</div>
                    <small>Current Tab</small>
                </div>
                <div class="browser-btn" onclick="openInBrowser('new')">
                    <div>üîó</div>
                    <small>New Tab</small>
                </div>
                <div class="browser-btn" onclick="openInBrowser('window')">
                    <div>ü™ü</div>
                    <small>New Window</small>
                </div>
                <div class="browser-btn" onclick="copyToClipboard()">
                    <div>üìã</div>
                    <small>Copy URL</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        class URLDepository {
            constructor() {
                this.links = JSON.parse(localStorage.getItem('yURLinkManager') || '[]');
                this.currentEditingId = null;
                this.currentUrl = '';
                this.currentTheme = localStorage.getItem('yURLinkTheme') || 'ocean';
                this.currentShareLink = null;
                this.init();
            }

            init() {
                this.applyTheme(this.currentTheme);
                this.renderLinks();
                this.updateStats();
                this.populateCategories();
                this.bindEvents();
                this.autoSave();
            }

            bindEvents() {
                document.getElementById('addLinkForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addLink();
                });

                document.getElementById('editLinkForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateLink();
                });

                document.getElementById('searchInput').addEventListener('input', () => {
                    this.renderLinks();
                });

                document.getElementById('categoryFilter').addEventListener('change', () => {
                    this.renderLinks();
                });

                document.getElementById('sortBy').addEventListener('change', () => {
                    this.renderLinks();
                });

                // Auto-paste URL detection
                document.addEventListener('paste', (e) => {
                    const pastedText = e.clipboardData.getData('text');
                    if (this.isValidUrl(pastedText) && document.activeElement.id === 'linkUrl') {
                        setTimeout(() => {
                            this.fetchUrlMetadata(pastedText);
                        }, 100);
                    }
                });
            }

            isValidUrl(string) {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            }

            async fetchUrlMetadata(url) {
                // In a real app, you'd fetch metadata from the URL
                // For demo purposes, we'll extract domain
                try {
                    const domain = new URL(url).hostname;
                    if (!document.getElementById('linkTitle').value) {
                        document.getElementById('linkTitle').value = domain;
                    }
                } catch (e) {
                    console.log('Invalid URL');
                }
            }

            addLink() {
                const title = document.getElementById('linkTitle').value.trim();
                const url = document.getElementById('linkUrl').value.trim();
                const category = document.getElementById('linkCategory').value.trim() || 'General';
                const tags = document.getElementById('linkTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);

                if (!title || !url) return;

                // Check for duplicate URL
                const existingLink = this.findDuplicateUrl(url);
                if (existingLink) {
                    this.showDuplicateDialog(existingLink, { title, url, category, tags });
                    return;
                }

                const link = {
                    id: Date.now(),
                    title,
                    url,
                    category,
                    tags,
                    dateAdded: new Date().toISOString(),
                    clickCount: 0
                };

                this.links.unshift(link);
                this.save();
                this.renderLinks();
                this.updateStats();
                this.populateCategories();
                
                // Reset form
                document.getElementById('addLinkForm').reset();
                
                // Show success feedback
                this.showNotification('‚úÖ Link added successfully!');
            }

            editLink(id) {
                const link = this.links.find(l => l.id === id);
                if (!link) return;

                this.currentEditingId = id;
                document.getElementById('editTitle').value = link.title;
                document.getElementById('editUrl').value = link.url;
                document.getElementById('editCategory').value = link.category;
                document.getElementById('editTags').value = link.tags.join(', ');
                
                document.getElementById('editModal').style.display = 'block';
            }

            updateLink() {
                const linkIndex = this.links.findIndex(l => l.id === this.currentEditingId);
                if (linkIndex === -1) return;

                const newUrl = document.getElementById('editUrl').value.trim();
                
                // Check for duplicate URL (excluding current link)
                const existingLink = this.findDuplicateUrl(newUrl, this.currentEditingId);
                if (existingLink) {
                    alert(`‚ö†Ô∏è Duplicate URL detected!\n\nThis URL already exists as:\n"${existingLink.title}"\n\nPlease use a different URL or update the existing link.`);
                    return;
                }

                this.links[linkIndex] = {
                    ...this.links[linkIndex],
                    title: document.getElementById('editTitle').value.trim(),
                    url: newUrl,
                    category: document.getElementById('editCategory').value.trim() || 'General',
                    tags: document.getElementById('editTags').value.split(',').map(tag => tag.trim()).filter(tag => tag)
                };

                this.save();
                this.renderLinks();
                this.updateStats();
                this.populateCategories();
                this.closeModal('editModal');
                this.showNotification('‚úÖ Link updated successfully!');
            }

            deleteLink(id) {
                if (confirm('Are you sure you want to delete this link?')) {
                    this.links = this.links.filter(l => l.id !== id);
                    this.save();
                    this.renderLinks();
                    this.updateStats();
                    this.populateCategories();
                    this.showNotification('üóëÔ∏è Link deleted successfully!');
                }
            }

            shareLink(id) {
                const link = this.links.find(l => l.id === id);
                if (!link) return;

                this.currentShareLink = link;
                
                // Update modal content
                document.getElementById('shareTitle').textContent = link.title;
                document.getElementById('shareUrl').textContent = link.url;
                
                // Setup social media links
                const encodedUrl = encodeURIComponent(link.url);
                const encodedTitle = encodeURIComponent(link.title);
                const encodedText = encodeURIComponent(`Check out this link: ${link.title}`);
                
                document.getElementById('twitterShare').href = 
                    `https://twitter.com/intent/tweet?text=${encodedText}&url=${encodedUrl}`;
                
                document.getElementById('facebookShare').href = 
                    `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;
                
                document.getElementById('linkedinShare').href = 
                    `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`;
                
                document.getElementById('redditShare').href = 
                    `https://reddit.com/submit?url=${encodedUrl}&title=${encodedTitle}`;
                
                document.getElementById('telegramShare').href = 
                    `https://t.me/share/url?url=${encodedUrl}&text=${encodedText}`;
                
                document.getElementById('whatsappShare').href = 
                    `https://wa.me/?text=${encodedText}%20${encodedUrl}`;
                
                document.getElementById('shareModal').style.display = 'block';
            }

            openLink(id) {
                const link = this.links.find(l => l.id === id);
                if (!link) return;

                this.currentUrl = link.url;
                
                // Increment click count
                link.clickCount++;
                this.save();
                
                document.getElementById('browserModal').style.display = 'block';
            }

            renderLinks() {
                const container = document.getElementById('linksGrid');
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const categoryFilter = document.getElementById('categoryFilter').value;
                const sortBy = document.getElementById('sortBy').value;

                let filteredLinks = this.links.filter(link => {
                    const matchesSearch = !searchTerm || 
                        link.title.toLowerCase().includes(searchTerm) ||
                        link.url.toLowerCase().includes(searchTerm) ||
                        link.tags.some(tag => tag.toLowerCase().includes(searchTerm));
                    
                    const matchesCategory = !categoryFilter || link.category === categoryFilter;
                    
                    return matchesSearch && matchesCategory;
                });

                // Sort links
                filteredLinks.sort((a, b) => {
                    switch (sortBy) {
                        case 'oldest':
                            return new Date(a.dateAdded) - new Date(b.dateAdded);
                        case 'title':
                            return a.title.localeCompare(b.title);
                        default: // newest
                            return new Date(b.dateAdded) - new Date(a.dateAdded);
                    }
                });

                if (filteredLinks.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div style="font-size: 4em;">üîó</div>
                            <h3>No links found</h3>
                            <p>Add your first link to get started!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredLinks.map(link => `
                    <div class="link-card">
                        <div class="link-header">
                            <div>
                                <div class="link-title">${link.title}</div>
                                <a href="${link.url}" class="link-url" target="_blank">${link.url}</a>
                            </div>
                            <div class="link-actions">
                                <button class="btn-small btn-open" onclick="app.openLink(${link.id})" title="Open Link">üåê</button>
                                <button class="btn-small btn-edit" onclick="app.editLink(${link.id})" title="Edit">‚úèÔ∏è</button>
                                <button class="btn-small btn-share" onclick="app.shareLink(${link.id})" title="Share">üì§</button>
                                <button class="btn-small btn-delete" onclick="app.deleteLink(${link.id})" title="Delete">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="link-meta">
                            <div>
                                <div class="tags">
                                    <span class="tag">${link.category}</span>
                                    ${link.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                                </div>
                            </div>
                            <div>
                                <span class="date-added">Added: ${new Date(link.dateAdded).toLocaleDateString()}</span>
                                ${link.clickCount > 0 ? `<span class="date-added"> ‚Ä¢ Clicks: ${link.clickCount}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            updateStats() {
                document.getElementById('totalLinks').textContent = this.links.length;
                
                const uniqueTags = new Set();
                this.links.forEach(link => {
                    uniqueTags.add(link.category);
                    link.tags.forEach(tag => uniqueTags.add(tag));
                });
                document.getElementById('totalTags').textContent = uniqueTags.size;

                const today = new Date().toDateString();
                const todayCount = this.links.filter(link => 
                    new Date(link.dateAdded).toDateString() === today
                ).length;
                document.getElementById('todayAdded').textContent = todayCount;
            }

            populateCategories() {
                const select = document.getElementById('categoryFilter');
                const categories = [...new Set(this.links.map(link => link.category))];
                
                select.innerHTML = '<option value="">All Categories</option>' +
                    categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
            }

            save() {
                localStorage.setItem('yURLinkManager', JSON.stringify(this.links));
            }

            autoSave() {
                setInterval(() => {
                    this.save();
                }, 30000); // Auto-save every 30 seconds
            }

            showNotification(message) {
                // Simple notification - in a real app you'd use a toast library
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    z-index: 10000;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                `;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
                this.currentEditingId = null;
            }

            findDuplicateUrl(url, excludeId = null) {
                const normalizedUrl = this.normalizeUrl(url);
                return this.links.find(link => 
                    link.id !== excludeId && 
                    this.normalizeUrl(link.url) === normalizedUrl
                );
            }

            normalizeUrl(url) {
                try {
                    const urlObj = new URL(url);
                    // Remove common variations to catch true duplicates
                    let normalized = urlObj.href.toLowerCase();
                    // Remove trailing slash
                    normalized = normalized.replace(/\/$/, '');
                    // Remove www. prefix
                    normalized = normalized.replace(/\/\/www\./, '//');
                    // Remove common tracking parameters
                    const trackingParams = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content', 'utm_term', 'fbclid', 'gclid'];
                    const urlWithoutTracking = new URL(normalized);
                    trackingParams.forEach(param => urlWithoutTracking.searchParams.delete(param));
                    return urlWithoutTracking.href;
                } catch (e) {
                    return url.toLowerCase().replace(/\/$/, '');
                }
            }

            showDuplicateDialog(existingLink, newLinkData) {
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'block';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 600px;">
                        <button class="close-modal" onclick="this.parentElement.parentElement.remove()">&times;</button>
                        <h3 style="color: #ff6b6b; margin-bottom: 20px;">‚ö†Ô∏è Duplicate URL Detected!</h3>
                        
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                            <h4 style="color: #856404; margin-bottom: 10px;">Existing Link:</h4>
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                                <strong>${existingLink.title}</strong><br>
                                <small style="color: #666;">${existingLink.url}</small><br>
                                <small style="color: #666;">Category: ${existingLink.category} | Added: ${new Date(existingLink.dateAdded).toLocaleDateString()}</small>
                            </div>
                        </div>

                        <div style="background: #e8f4f8; border: 1px solid #bee5eb; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                            <h4 style="color: #0c5460; margin-bottom: 10px;">New Link (attempting to add):</h4>
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <strong>${newLinkData.title}</strong><br>
                                <small style="color: #666;">${newLinkData.url}</small><br>
                                <small style="color: #666;">Category: ${newLinkData.category}</small>
                            </div>
                        </div>

                        <p style="margin-bottom: 20px; color: #666;">What would you like to do?</p>
                        
                        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn-small btn-edit" onclick="app.editExistingLink(${existingLink.id}); this.parentElement.parentElement.parentElement.remove();">
                                ‚úèÔ∏è Edit Existing
                            </button>
                            <button class="btn-small btn-open" onclick="app.openLink(${existingLink.id}); this.parentElement.parentElement.parentElement.remove();">
                                üåê Open Existing
                            </button>
                            <button class="btn-small btn-share" onclick="app.addDuplicateAnyway(${JSON.stringify(newLinkData).replace(/"/g, '&quot;')}); this.parentElement.parentElement.parentElement.remove();">
                                ‚ûï Add Anyway
                            </button>
                            <button class="btn-small btn-delete" onclick="this.parentElement.parentElement.parentElement.remove();">
                                ‚ùå Cancel
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            editExistingLink(id) {
                this.editLink(id);
            }

            addDuplicateAnyway(linkData) {
                const link = {
                    id: Date.now(),
                    title: linkData.title,
                    url: linkData.url,
                    category: linkData.category,
                    tags: linkData.tags,
                    dateAdded: new Date().toISOString(),
                    clickCount: 0
                };

                this.links.unshift(link);
                this.save();
                this.renderLinks();
                this.updateStats();
                this.populateCategories();
                
                // Reset form
                document.getElementById('addLinkForm').reset();
                
                this.showNotification('‚úÖ Duplicate link added successfully!');
            }

            isDuplicateUrl(url, excludeId) {
                return this.findDuplicateUrl(url, excludeId) !== undefined;
            }

            changeTheme(themeName) {
                this.currentTheme = themeName;
                this.applyTheme(themeName);
                localStorage.setItem('yURLinkTheme', themeName);
            }

            applyTheme(themeName) {
                // Remove all theme classes
                document.body.className = document.body.className.replace(/theme-\w+/g, '');
                // Add new theme class
                document.body.classList.add(`theme-${themeName}`);
                
                // Update active theme button
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`.theme-btn.${themeName}`).classList.add('active');
            }
        }

        // Global functions for modal interactions
        function closeModal(modalId) {
            app.closeModal(modalId);
        }

        function openInBrowser(type) {
            switch (type) {
                case 'current':
                    window.location.href = app.currentUrl;
                    break;
                case 'new':
                    window.open(app.currentUrl, '_blank');
                    break;
                case 'window':
                    window.open(app.currentUrl, '_blank', 'width=800,height=600');
                    break;
            }
            closeModal('browserModal');
        }

        function copyToClipboard() {
            navigator.clipboard.writeText(app.currentUrl).then(() => {
                app.showNotification('üìã URL copied to clipboard!');
                closeModal('browserModal');
            });
        }

        function copyShareLink() {
            if (app.currentShareLink) {
                navigator.clipboard.writeText(app.currentShareLink.url).then(() => {
                    app.showNotification('üìã Link copied to clipboard!');
                    closeModal('shareModal');
                });
            }
        }

        function copyShareLink(url) {
            navigator.clipboard.writeText(url).then(() => {
                app.showNotification('üìã Link copied to clipboard!');
            });
        }

        function shareViaEmail(title, url) {
            window.location.href = `mailto:?subject=${title}&body=Check out this link: ${url}`;
        }

        function exportLinks() {
            const data = JSON.stringify(app.links, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `yurlink-manager-export-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            app.showNotification('üì§ Links exported successfully!');
        }

        // Initialize the app
        const app = new URLDepository();

        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
    </script>
</body>
</html>
